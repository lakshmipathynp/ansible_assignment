---
hosts: "{{reqhosts}}"
become: yes
gather_facts: true
vars: 
  ca_cert_file: "CA1.crt"
  ca_cert_path: "/usr/local/share/ca-certificates/{{ ca_cert_file }}"
  ca_cert_name: "{{ ca_cert_file.split('.')[0] }}"
tasks: 
  - name: verify the CA certificate validity
    command: openssl x509 -in "{{ ca_cert_file }}" -noout -dates
    register: certificate_validity

  - name: Display certificate information  
    debug: 
      msg: "{{certificate_validity.stdout}}"

  - name: copy CA certificate to target machines
    copy: 
        src: "{{ca_cert_file}}"
        dest: "{{ca_cert_path}}"
        mode: '0644'
  - name: Install Custom CA certificates on Debian
    command: update-ca-certificates
    when: ansible_os_family == 'Debian' 
  
  - name: Install Custom CA certificates on RHEL
    copy: 
        src: "{{ ca_cert_file }}"
        dest: "/etc/pki/ca-trust/source/anchors/{{ ca_cert_file }}"
        mode: '0644'
  - name: Update CA trust store
    command: update-ca-trust extract    
    when: ansible_os_family == 'RedHat'